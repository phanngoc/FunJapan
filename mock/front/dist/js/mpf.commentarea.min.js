function loadArticleComments(n,t,i,r,u){var o=$.Deferred(),s,e,c;$(".comment-area").find(".no-match-message").remove();var f=t.hasClass("media-list-comments-replies"),l=f?t.closest("li.media[data-article-comment-id]").attr("data-article-comment-id"):null,a=r?t.find("> li").length:0,h="";if(f||(s=$.trim(t.closest(".comment-area").find(".comment-search-form").find("input").val()),s!=""&&(h=" and contains(Author/DisplayName,'"+s+"')")),e="PostedDate desc",!f)switch(t.closest(".comment-area").find("ul.comment-sort-list").attr("data-comment-sort")){case"Newest":e="PostedDate desc";break;case"Oldest":e="PostedDate asc";break;case"Popular":e="Stats/LikeCount desc, PostedDate desc"}return c={$top:f?i:i+1,$skip:a,$expand:"Stats",$filter:"ArticleId eq "+n+" and ParentCommentId eq "+l+" and Country eq '"+MPF.current.country+"'"+h,$count:u?!0:!1,$orderby:e},MPF.api.article.comment.getArticleComments(c).done(function(n){var e=$("<ul><\/ul>"),u;r||t.empty();u=n.value;f?u=u.reverse():u.length<=i?t.closest(".comment-area").find(".comment-more").hide():(t.closest(".comment-area").find(".comment-more").show(),u.pop());$.each(u,function(n,i){t.find('> li[data-article-comment-id="'+i.Id+'"]').length>0||e.append(buildArticleCommentEntry(i))});t.append(e.children());f&&t.find(".comment-reply-panel").remove();t.find("li[data-article-comment-owner]").each(function(){var n=$(this);(n.data("article-comment-owner")||n.parents("li.media[data-article-comment-owner]").data("article-comment-owner")||MPF.current.user.isAdmin)&&n.find(".btn-delete").show()});o.resolve(n)}).fail(function(n){o.reject(n)}),o.promise()}function buildArticleCommentEntry(n){var t=$('<li class="media"><div class="pull-left" style="position:relative"><img class="media-object"><\/div><div class="media-body"><p class="h4 media-heading"><\/p><p class="pull-left"><span class="datetime"><\/span><\/p><div class="pull-right"><a class="btn-delete" href="javascript: void(0);">delete<\/a><\/div><\/div><p class="comment-body"><\/p><div class="text-right"><div class="pull-left comment-reply-panel"><a href="javascript:void(0);"><i class="fa fa-reply fa-rotate-180"><\/i>Write a reply<\/a><\/div><ul class="engagement"><span><strong>Like & Thanks<\/strong><\/span><li><a class="pull-left engagement-comment-favorite engagement-interactive" href="javascript:void(0);"><i class="fa fa-heart"><\/i><\/a><span class="engagement-count"><\/span><\/li><\/ul><\/div><\/li>').attr("data-article-comment-id",n.Id).attr("data-article-comment-owner",n.PostedBy==MPF.current.user.userId?!0:!1).find(".datetime").text("Posted At "+new Date(n.PostedDate).toLocaleString()).end().find(".comment-body").text(n.Message).end().find(".engagement-count").text(n.Stats.LikeCount).end().find(".btn-delete").hide().end();return MPF.getPublicUserProfile(n.PostedBy).done(function(i){t.find(".media-heading").text(i.DisplayName).end();var r=t.find(".media-object");r.attr("src",i.PictureUrl).attr("alt",i.DisplayName).end();n.PostedBy!=MPF.current.user.userId||i.PictureUrl.match(/facebook/)||(r.wrap('<a class="text-center" href="https://gravatar.com/" target="_blank"><\/a>').end(),r.after('<span><i class="fa fa-plus-square"><\/i> Picture<\/span>').end())}).fail(function(n){n.status==404&&t.find(".media-heading").text("(Someone)").end().find(".media-object").attr("src","/mpf/images/no-profile-picture.png").attr("alt","(Someone)").end()}),n.Stats.ReplyCount>1?t.find(".comment-reply-panel a").html('<i class="fa fa-reply fa-rotate-180"><\/i>View '+n.Stats.ReplyCount+" replies"):n.Stats.ReplyCount==1&&t.find(".comment-reply-panel a").html('<i class="fa fa-reply fa-rotate-180"><\/i>View '+n.Stats.ReplyCount+" reply"),MPF.api.article.comment.isCommentLiked(n.Id).done(function(n){n.value&&t.find("ul.engagement > li").addClass("active")}),t.find("ul.engagement > li").click(function(){var t=$(this);if(t.hasClass("disabled"))return!1;t.addClass("disabled");MPF.current.user.isAuthenticated?MPF.api.article.comment.toggleLike(n.Id).done(function(i){MPF.api.article.comment.getArticleComments({$filter:"Id eq "+n.Id,$expand:"Stats"}).done(function(n){t.children("span.engagement-count").text(n.value[0].Stats.LikeCount);i.value?t.addClass("active"):t.removeClass("active");t.removeClass("disabled")})}):location.href=MPF.getLoginUrl()}),t.find(".btn-delete").click(function(){$(this).addClass("disabled");var i=$(this).closest(".comment-area").find("div.modal");i.modal("show");i.on("click",".modal-footer .btn-primary",function(){i.modal("hide");i.off("click");MPF.api.article.comment.deleteArticleComment(n.Id).always(function(){if(t.slideUp(400,function(){$(this).remove()}),!n.ParentCommentId){var i=t.closest(".comment-area").find("span.comment-count"),r=parseInt(i.text(),10)-1;i.text(r)}})})}),t.find(".comment-reply-panel > a").click(function(){var i=parseInt(n.Stats.ReplyCount)-2,t=$('<div style="margin-left: 32px; margin-bottom: 10px; padding: 10px; background-color: #eee;"><span class="comment-reply-panel"><a href="javascript:void(0);" style="text-decoration: underline;">View all replies ('+i+')<\/a><\/span><ul class="media-list media-list-comments media-list-comments-replies"><\/ul><\/div>').append($(this).closest(".comment-area").find("> .comment-posting-form").clone(!0));t.find(".comment-posting-form .alert").addClass("hidden");t.find(".comment-posting-form").parent().find("> span.comment-reply-panel > a").addClass("hidden");t.find(".comment-posting-form").find("textarea").attr("placeholder","Write reply...").end().find("button.btn").text("Post reply").end();$(this).closest("li.media").append(t);$(this).closest(".comment-reply-panel").remove();loadArticleComments(MPF.current.itemId,t.find(".media-list-comments"),2,!1,!0).done(function(n){var i=parseInt(n["@odata.count"])-2;i>0&&t.find(".comment-posting-form").parent().find("> span.comment-reply-panel > a").removeClass("hidden").text("View all replies ("+i+")")});t.find(".comment-reply-panel > a").click(function(){var n=$(this);loadArticleComments(MPF.current.itemId,t.find(".media-list-comments"),undefined,!1,!0).done(function(){n.hide()})})}),t}$(function(){var n,t;MPF.api.article.comment.getArticleComments({$count:!0,$top:0,$filter:"ArticleId eq "+MPF.current.itemId+" and ParentCommentId eq null and Country eq '"+MPF.current.country+"'"}).done(function(n){$("span.comment-count").text(n["@odata.count"])});loadArticleComments(MPF.current.itemId,$(".comment-area .media-list-comments"),5);$(".comment-posting-form button").click(function(){var n=$(this),t,i,r;(n.closest(".comment-area").find(".no-match-message").remove(),t=n.closest("form").find("textarea"),i=t.val(),i.length!=0)&&(n.prop("disabled",!0),r=n.closest("li.media[data-article-comment-id]").attr("data-article-comment-id"),MPF.api.article.comment.postArticleComment(MPF.current.itemId,MPF.current.country,i,r).done(function(i){var f,u,e,o;t.val("");n.closest(".comment-posting-form").find(".alert").addClass("hidden").find("ul > li").addClass("hidden");f=n.closest(".comment-posting-form").parent().find("> .media-list-comments");i.Stats={LikeCount:0,ReplyCount:0};u=buildArticleCommentEntry(i).hide();u.find(".btn-delete").show();r?f.append(u.find(".comment-reply-panel").remove().end()):(f.prepend(u.find(".comment-reply-panel").show().end()),e=f.closest(".comment-area").find("span.comment-count"),o=parseInt(e.text())+1,e.text(o));u.slideDown(400)}).fail(function(t){t.status==503&&n.closest(".comment-posting-form").find(".alert").removeClass("hidden").find("ul > li:nth-child(1)").removeClass("hidden");t.status==400&&n.closest(".comment-posting-form").find(".alert").removeClass("hidden").find("ul > li:nth-child(2)").removeClass("hidden");t.status==403&&n.closest(".comment-posting-form").find(".alert").removeClass("hidden").find("ul > li:nth-child(3)").removeClass("hidden")}).always(function(){n.prop("disabled",!1)}))});n=$(".comment-area").find(".comment-search-form");n.find("button").click(function(){loadArticleComments(MPF.current.itemId,$(".comment-area > .media-list-comments"),5,!1,!1).done(function(n){n.value.length==0&&$(".comment-area > hr").after('<div class="no-match-message"><p>No match found.<\/p><hr/><\/div>')})});n.find(".input-group").find("input:first-child").keyup(function(n){n.which==13&&$(this).closest(".input-group").find("button").click()});$(".comment-area button.comment-search-mini-btn").click(function(){n.find("div.input-group").removeClass("hidden-xs");$(this).addClass("hidden")});t=$(".comment-area  ul.comment-sort-list");t.find("> li").click(function(){var n=$(this);t.attr("data-comment-sort",n.text()).find("> li").removeClass("active");n.addClass("active");loadArticleComments(MPF.current.itemId,$(".comment-area > .media-list-comments"),5).done(function(n){n.value.length==0&&$(".comment-area > hr").after('<div class="no-match-message"><p>No match found.<\/p><hr/><\/div>')})}).end();$(".comment-area .comment-more > a").click(function(){var n=parseInt($(this).text(),10);loadArticleComments(MPF.current.itemId,$(".comment-area > .media-list-comments"),n,!0,!1)})});
/*
//# sourceMappingURL=mpf.commentarea.min.js.map
*/