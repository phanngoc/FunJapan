(function(n){function t(t,i,r){mpf.LinkButtonBase.call(this,t);this.isInteractive=n(t).hasClass("engagement-interactive");this.context_=i;this.sitecoreContext_=r;Modernizr.csstransitions&&t.next("span.engagement-count").addClass("fa fa-spinner fa-spin");this.reload(n.proxy(function(){this.isEnabled(!0)},this))}if(!n.fn.favoriteButton){var r={hasFavorite:"active"},i={articleId:"mpfArticleId"};n.fn.favoriteButton=function(i,r){return this.each(function(){new t(n(this),i,r)})};t.minClickInterval=1e3;t.prototype=n.extend(new mpf.LinkButtonBase,{isInteractive:!1,hasFavorite_:!1,count_:0,buttonOnClick_:function(){if(this.isInteractive){if(!this.context_.isLoggedIn){location.href=this.sitecoreContext_.getLoginUrl();return}this.hasFavorite_?this.remove_():this.add_()}},add_:function(){var r=this.count_;this.isEnabled(!1);this.setHasFavorite_(!0);this.setCount_(r+1);n.ajax({url:this.context_.webApiSiteUrl+"articles/"+this.$linkElem_.data(i.articleId)+"/favorites",type:"POST",headers:this.context_.requestHeaders}).done(n.proxy(function(){this.reload()},this)).fail(n.proxy(function(){this.setHasFavorite_(!1);this.setCount_(r)},this));setTimeout(n.proxy(function(){this.isEnabled(!0)},this),t.minClickInterval)},remove_:function(){var r=this.count_;this.isEnabled(!1);this.setHasFavorite_(!1);this.setCount_(r-1);n.ajax({url:this.context_.webApiSiteUrl+"articles/"+this.$linkElem_.data(i.articleId)+"/favorites",type:"DELETE",headers:this.context_.requestHeaders}).done(n.proxy(function(){this.reload()},this)).fail(n.proxy(function(){this.setHasFavorite_(!0);this.setCount_(r)},this));setTimeout(n.proxy(function(){this.isEnabled(!0)},this),t.minClickInterval)},setHasFavorite_:function(n){this.hasFavorite_=n;n?this.$linkElem_.addClass(r.hasFavorite):this.$linkElem_.removeClass(r.hasFavorite)},reload:function(n){var i=0,t=function(){++i==2&&n&&n()};this.loadState_().always(t);this.loadCount_().always(t)},loadState_:function(){return n.ajax({url:this.context_.webApiSiteUrl+"my/favorites/articles/"+this.$linkElem_.data(i.articleId),type:"GET",headers:this.context_.requestHeaders}).done(n.proxy(function(){this.setHasFavorite_(!0)},this)).fail(n.proxy(function(){this.setHasFavorite_(!1)},this))},loadCount_:function(){return n.ajax({url:this.context_.webApiSiteUrl+"articles/"+this.$linkElem_.data(i.articleId)+"/favorites/count",type:"GET"}).done(n.proxy(function(n){this.$linkElem_.next("span.engagement-count").removeClass("fa fa-spinner fa-spin");this.setCount_(n)},this))},setCount_:function(n){this.count_=n;this.ensureCountElem_().text(n)},ensureCountElem_:function(){var t=this.$linkElem_.next("span.engagement-count");return t.size()>0?t:n('<span class="engagement-count"><\/span>').insertAfter(this.$linkElem_)}})}})(jQuery);
/*
//# sourceMappingURL=jquery.mpf.favoritebutton.min.js.map
*/